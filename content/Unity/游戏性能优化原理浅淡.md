---
title: Example Title
draft: false
tags:
  - example-tag
---
 
The rest of your content lives here. You can use **Markdown** here :)

	以Unity引擎为例

# First thing First

第一步，是不是真的有性能问题？

1. 物理观察法：在移动端如果手机都烫手了，那肯定是不能接受的!
	![[Pasted image 20241101144655.png]]

2. 卡了？是平均帧率过低还是只在某一帧卡顿？

	游戏是定位性能热点（hot spot），都可以使用Profiler工具来分析每一帧的函数调用情况，一般像Unity的自带的Proflier工具，都能看到每一帧的函数调用情况，各个模块的调用开销，这个就叫做**采样分析**：

	![[Pasted image 20241101150114.png]]

**采样分析**是最基本的手段，卡顿的话是出在CPU还是GPU?
问题随之而来：我们应该关注哪些指标呢？

- **Frame Time**：16.666..，33.333... ms 这对游戏开发者来讲是再熟悉不过的数字了，对应60、30FPS下的帧耗时，平均帧率过低说明CPU可能出现瓶颈。
	出现了尖峰，说明某一帧耗时过高了，这种就是帧率的波动了，感觉上就是突然卡了下：
	![[Pasted image 20241101150157.png]]

- **Draw Call Batches**（DC）：这也是很基础的指标，DC过高CPU会忙于提交渲染数据到GPU,也会造成CPU的性能瓶颈，造成设备发烫，每个DC提交的三角形数量过少也会造成CPU瓶颈：
	- 所有每帧提交多少个DC、每个DC提交渲染图元的熟练也很重要，需要取得一个平衡：
	![[Pasted image 20241101162411.png]]
	英伟达开发者文档有个PPT讨论了这个问题：[https://www.nvidia.de/docs/io/8230/batchbatchbatch.pdf]
	
- **内存消耗**：内存消耗过高，分配对象数量过多会在后续造成频繁的GC(垃圾回收)，在移动平台尤其是IOS设备本身可用内存较小可能会造成闪退等问题，在PC平台内存占用过高会**触发虚拟内存的交换**（即将内存的数据换出去存在磁盘上）。
	这一点切身体会过，在上大学笔者一台4G内存的游戏本一打开PS，再打开几个内存杀手——Chrome页面，电脑就会开始很卡顿，这是因为内外存IO速度了至少一个数量级：
	![[Pasted image 20241101164840.png]]
	 一个关于Chrome的Meme:![[Pasted image 20241101165246.png]]
   
   1. 确定自己写的逻辑是不是有问题？
前面提到的能从整体上判断是否是哪里